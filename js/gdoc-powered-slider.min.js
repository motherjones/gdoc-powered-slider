/*! Gdoc Powered Slider - v0.1.0 - 2013-01-02
* https://github.com/motherjones/gdoc-powered-slider
* Copyright (c) 2013 Ben Breedlove; Licensed MIT, GPL */
(function(a){a.slideshow=function(b,c){var d,e,f,g,h,b,i,j=!1,k={container:"slideshow_container",init:function(a,b){i=this;if(b)for(var c in b)i[c]=b[c];h=function(){return document.location.search?document.location.search.match("slide")?parseInt(document.location.search.replace("?slide=","")):0:0}();if(typeof a=="string")return i.make_slides_from_google_spreadsheet(a),i;i.calculate_aspectratios(a),i.slides=i.make_html_from_slide_data(a),i.create_cover();for(var e=0;e<i.slides.length;e++)i.append_slide(i.slides[e]);return jQuery(window).bind("popstate",function(a){slide=event.state?event.state.slide:function(){return document.location.search?document.location.search.match("slide")?parseInt(document.location.search.replace("?slide=","")):0:0}(),a.originalEvent.state&&(j=!0),i.swipe.slide(slide)}),j=!1,i.swipe=new Swipe(document.getElementById(i.container),{startSlide:parseInt(h),speed:500,callback:function(a,b,c){d.find(".control_container .disabled").removeClass("disabled"),b===0?d.find(".control_container #slideshow_back_button").addClass("disabled"):b===i.slides.length&&d.find(".control_container #slideshow_next_button").addClass("disabled"),d.find(".selected").removeClass("selected"),d.find(".pagination_"+b).addClass("selected"),j||history.pushState({slide:parseInt(b)},"slide "+b,"?slide="+b),j=!1}}),i.control_container=i.create_controls(),d.append(i.control_container),i.swipe.index===0?d.find(".control_container #slideshow_back_button").addClass("disabled"):i.swipe.index===i.slides.length-1&&d.find(".control_container #slideshow_next_button").addClass("disabled"),jQuery(document).bind("resize",function(){i.control_container.remove(),i.pagination.remove(),i.cover.html(""),i.init()}),d.mouseout(function(a){jQuery(document).unbind("keydown",i.keydown_event)}),d.mouseover(function(){jQuery(document).keydown(i.keydown_event)}),i},keydown_event:function(a){return a.keyCode===37?i.back():a.keyCode===39&&i.next(),!1},make_slides_from_google_spreadsheet:function(a){Tabletop.init({key:a,callback:function(a){var b=i.make_slides_data_from_spreadsheet_data(a);i.init(b,c)},simpleSheet:!0})},make_slides_data_from_spreadsheet_data:function(a){return a},make_html_from_slide_data:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c],e={};e.html=i.build_slide_html_from_row(d),b[c]=e}return b},build_slide_html_from_row:function(a){return"<li "+(a.backgroundimage?'class="slide_with_background_image" style="background-image: url(\''+a.backgroundimage+"');\">":">")+(a.topimage?'<img src="'+a.topimage+'" class="topimage"></img>':"")+(a.topaspectratio?'<div class="videoembed" style="padding-bottom:'+a.topaspectratio+'%">'+a.topvideoembed+"</div>":"")+(a.title?"<h1>"+a.title+"</h1>":"")+(a.middleimage?'<img src="'+a.middleimage+'" class="middleimage"></img>':"")+(a.middleaspectratio?'<div class="videoembed" style="padding-bottom:'+a.middleaspectratio+'%">'+a.middlevideoembed+"</div>":"")+"<p>"+a.text+"</p>"+(a.bottomimage?'<img src="'+a.bottomimage+'" class="bottomimage"></img>':"")+(a.bottomaspectratio?'<div class="videoembed" style="padding-bottom:'+a.bottomaspectratio+'%">'+a.bottomvideoembed+"</div>":"")+"</li>"},find_aspectratio:function(a){var b=a.match(/height="\d+"/);if(!b[0]){console.log("Your video embed code needs a height.");return}b=parseInt(b[0].replace(/height="/,"").replace(/"/,""));var c=a.match(/width="\d+"/);if(!c[0]){console.log("Your video embed code needs a width.");return}return c=parseInt(c[0].replace(/width="/,"").replace(/"/,"")),b/c*100},calculate_aspectratios:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.topvideoembed&&(c.topaspectratio=i.find_aspectratio(c.topvideoembed)),c.middlevideoembed&&(c.middleaspectratio=i.find_aspectratio(c.middlevideoembed)),c.bottomvideoembed&&(c.bottomaspectratio=i.find_aspectratio(c.bottomvideoembed))}},create_cover:function(){d=a("#"+i.container),e=jQuery("<ul></ul>"),d.append(e),e.addClass("slideshow_container"),e.css("padding","0px"),i.set_slider_width()},create_pagination:function(){var a=jQuery('<ul class="pagination_container" style="display: inline; list-style-type: none;"></ul>');for(var b=0;b<i.slides.length;b++)item=jQuery('<li class="pagination_'+b+(b===parseInt(h)?" selected":"")+'">'+(b+1)+"</li>"),function(a,b){a.bind("click",function(){i.swipe.slide(b)})}(item,b),a.append(item);return a.after(jQuery("<span> of "+i.slides.length+"</span>")),a},set_slider_width:function(){return;var a},create_controls:function(){var a=jQuery('<div class="control_container"></div>');return a.append(i.create_back_button_elem()),i.pagination=i.create_pagination(),a.append(i.pagination),a.append(i.create_next_button_elem()),a},create_back_button_elem:function(){return g=a('<a id="slideshow_back_button" value="back">Back</a>'),g.click(function(){i.back()}),g.addClass("slideshow_top_controls"),g},create_next_button_elem:function(){return f=a('<a id="slideshow_next_button" value="next">Next</a>'),f.click(function(){i.next()}),f.addClass("slideshow_top_controls"),f},append_slide:function(a){a.element=jQuery(a.html),e.append(a.element)},display_slide:function(a){i.swipe(a)},back:function(){i.swipe.prev()},next:function(){i.swipe.index!==i.slides.length-1&&i.swipe.next()}};return k.init(b,c)},a.fn.slideshow=function(b,c){return c=c||{},c.container=this.attr("id"),this.slideshow=a.slideshow(b,c),this}})(jQuery);